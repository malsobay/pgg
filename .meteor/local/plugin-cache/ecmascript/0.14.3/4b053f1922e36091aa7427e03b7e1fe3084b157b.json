{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/empirica:core/ui/components/Game.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/components/Game.jsx"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 1);\n\nvar _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default: function (v) {\n    _objectWithoutProperties = v;\n  }\n}, 2);\n\nvar _createSuper;\n\nmodule.link(\"@babel/runtime/helpers/createSuper\", {\n  default: function (v) {\n    _createSuper = v;\n  }\n}, 3);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 4);\nmodule.export({\n  \"default\": function () {\n    return Game;\n  }\n});\nvar React;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 0);\nvar addPlayerInput;\nmodule.link(\"../../api/player-inputs/methods.js\", {\n  addPlayerInput: function (v) {\n    addPlayerInput = v;\n  }\n}, 1);\nvar markPlayerExitStepDone, playerReady;\nmodule.link(\"../../api/players/methods.js\", {\n  markPlayerExitStepDone: function (v) {\n    markPlayerExitStepDone = v;\n  },\n  playerReady: function (v) {\n    playerReady = v;\n  }\n}, 2);\nvar GameLobby;\nmodule.link(\"../components/GameLobby.jsx\", {\n  \"default\": function (v) {\n    GameLobby = v;\n  }\n}, 3);\nvar GameLobbyContainer;\nmodule.link(\"../containers/GameLobbyContainer.jsx\", {\n  \"default\": function (v) {\n    GameLobbyContainer = v;\n  }\n}, 4);\nvar DefaultBreadcrumb;\nmodule.link(\"./Breadcrumb.jsx\", {\n  \"default\": function (v) {\n    DefaultBreadcrumb = v;\n  }\n}, 5);\nvar DelayedDisplay;\nmodule.link(\"./DelayedDisplay.jsx\", {\n  \"default\": function (v) {\n    DelayedDisplay = v;\n  }\n}, 6);\nvar ExitSteps;\nmodule.link(\"./ExitSteps.jsx\", {\n  \"default\": function (v) {\n    ExitSteps = v;\n  }\n}, 7);\nvar InstructionSteps;\nmodule.link(\"./InstructionSteps.jsx\", {\n  \"default\": function (v) {\n    InstructionSteps = v;\n  }\n}, 8);\nvar Loading;\nmodule.link(\"./Loading.jsx\", {\n  \"default\": function (v) {\n    Loading = v;\n  }\n}, 9);\nvar WaitingForServer;\nmodule.link(\"./WaitingForServer.jsx\", {\n  \"default\": function (v) {\n    WaitingForServer = v;\n  }\n}, 10);\nvar DelayedWaitingForServer = DelayedDisplay(WaitingForServer, 250);\nvar DelayedGameLobby = DelayedDisplay(GameLobby, 250);\nvar playerReadyClicked = false;\n\nvar Game = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Game, _React$Component);\n\n  var _super = _createSuper(Game);\n\n  function Game() {\n    return _React$Component.apply(this, arguments) || this;\n  }\n\n  var _proto = Game.prototype;\n\n  _proto.shouldComponentUpdate = function () {\n    function shouldComponentUpdate(nextProps, nextState) {\n      return !_.isEqual(this.props, nextProps);\n    }\n\n    return shouldComponentUpdate;\n  }();\n\n  _proto.render = function () {\n    function render() {\n      var _this$props = this.props,\n          loading = _this$props.loading,\n          gameLobby = _this$props.gameLobby,\n          treatment = _this$props.treatment,\n          Round = _this$props.Round,\n          Breadcrumb = _this$props.Breadcrumb,\n          Waiting = _this$props.Waiting,\n          Lobby = _this$props.Lobby,\n          exitSteps = _this$props.exitSteps,\n          introSteps = _this$props.introSteps,\n          rest = _objectWithoutProperties(_this$props, [\"loading\", \"gameLobby\", \"treatment\", \"Round\", \"Breadcrumb\", \"Waiting\", \"Lobby\", \"exitSteps\", \"introSteps\"]);\n\n      var started = rest.started,\n          timedOut = rest.timedOut,\n          game = rest.game,\n          player = rest.player,\n          round = rest.round,\n          stage = rest.stage;\n\n      if (loading) {\n        return /*#__PURE__*/React.createElement(Loading, null);\n      }\n\n      if (player.exitAt) {\n        return /*#__PURE__*/React.createElement(ExitSteps, _extends({}, rest, {\n          steps: exitSteps(game || gameLobby, player),\n          game: game || gameLobby,\n          player: player,\n          onSubmit: function (stepName, data) {\n            var playerId = player._id;\n            markPlayerExitStepDone.call({\n              playerId: playerId,\n              stepName: stepName\n            }); // Checkig for data.nativeEvent, as that indicates the data is an\n            // event object dispached by React.\n\n            if (data && !data.nativeEvent) {\n              try {\n                var encoded = JSON.stringify(data);\n                addPlayerInput.call({\n                  playerId: playerId,\n                  data: encoded,\n                  gameId: game && game._id,\n                  gameLobbyId: game ? null : gameLobby && gameLobby._id\n                });\n              } catch (e) {\n                console.error(\"could not encode data returned by onSubmit\", e);\n              }\n            }\n          }\n        }));\n      }\n\n      if (!game) {\n        if (playerReadyClicked) {\n          return /*#__PURE__*/React.createElement(Loading, null);\n        }\n\n        if (player.readyAt) {\n          var gameLobbyProps = _objectSpread({}, rest, {\n            gameLobby: gameLobby,\n            game: gameLobby,\n            treatment: treatment,\n            player: player\n          });\n\n          return /*#__PURE__*/React.createElement(GameLobbyContainer, gameLobbyProps, Lobby ? /*#__PURE__*/React.createElement(Lobby, gameLobbyProps) : /*#__PURE__*/React.createElement(DelayedGameLobby, gameLobbyProps));\n        }\n\n        return /*#__PURE__*/React.createElement(InstructionSteps, _extends({}, rest, {\n          introSteps: introSteps,\n          treatment: treatment,\n          player: player,\n          onDone: function () {\n            playerReadyClicked = true;\n            playerReady.call({\n              _id: player._id\n            }, function () {\n              playerReadyClicked = false;\n            });\n          }\n        }));\n      }\n\n      var content;\n\n      if (timedOut || !started) {\n        if (Waiting) {\n          content = /*#__PURE__*/React.createElement(Waiting, null);\n        } else if (treatment.factor(\"playerCount\").value === 1) {\n          content = /*#__PURE__*/React.createElement(Loading, null);\n        } else {\n          content = /*#__PURE__*/React.createElement(DelayedWaitingForServer, null);\n        }\n      } else {\n        content = /*#__PURE__*/React.createElement(Round, rest);\n      }\n\n      var BC = Breadcrumb !== undefined ? Breadcrumb : DefaultBreadcrumb;\n      var breadcrumb = BC && /*#__PURE__*/React.createElement(BC, {\n        game: game,\n        player: player,\n        round: round,\n        stage: stage\n      });\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"game\"\n      }, breadcrumb, content);\n    }\n\n    return render;\n  }();\n\n  return Game;\n}(React.Component);","map":{"version":3,"sources":["packages/empirica:core/ui/components/Game.jsx"],"names":["_objectSpread","module","link","default","v","_extends","_objectWithoutProperties","_createSuper","_inheritsLoose","export","Game","React","addPlayerInput","markPlayerExitStepDone","playerReady","GameLobby","GameLobbyContainer","DefaultBreadcrumb","DelayedDisplay","ExitSteps","InstructionSteps","Loading","WaitingForServer","DelayedWaitingForServer","DelayedGameLobby","playerReadyClicked","shouldComponentUpdate","nextProps","nextState","_","isEqual","props","render","loading","gameLobby","treatment","Round","Breadcrumb","Waiting","Lobby","exitSteps","introSteps","rest","started","timedOut","game","player","round","stage","exitAt","stepName","data","playerId","_id","call","nativeEvent","encoded","JSON","stringify","gameId","gameLobbyId","e","console","error","readyAt","gameLobbyProps","content","factor","value","BC","undefined","breadcrumb","Component"],"mappings":"AAAA,IAAIA,aAAJ;;AAAkBC,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,IAAAA,aAAa,GAACI,CAAd;AAAgB;AAArC,CAAnD,EAA0F,CAA1F;;AAA6F,IAAIC,QAAJ;;AAAaJ,MAAM,CAACC,IAAP,CAAY,gCAAZ,EAA6C;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACC,IAAAA,QAAQ,GAACD,CAAT;AAAW;AAAhC,CAA7C,EAA+E,CAA/E;;AAAkF,IAAIE,wBAAJ;;AAA6BL,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACE,IAAAA,wBAAwB,GAACF,CAAzB;AAA2B;AAAhD,CAA7D,EAA+G,CAA/G;;AAAkH,IAAIG,YAAJ;;AAAiBN,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACG,IAAAA,YAAY,GAACH,CAAb;AAAe;AAApC,CAAjD,EAAuF,CAAvF;;AAA0F,IAAII,cAAJ;;AAAmBP,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACI,IAAAA,cAAc,GAACJ,CAAf;AAAiB;AAAtC,CAAnD,EAA2F,CAA3F;AAA3dH,MAAM,CAACQ,MAAP,CAAc;AAAC,aAAQ,YAAU;AAAC,WAAOC,IAAP;AAAY;AAAhC,CAAd;AAAiD,IAAIC,KAAJ;AAAUV,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACO,IAAAA,KAAK,GAACP,CAAN;AAAQ;AAA7B,CAApB,EAAmD,CAAnD;AAAsD,IAAIQ,cAAJ;AAAmBX,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACU,EAAAA,cAAc,EAAC,UAASR,CAAT,EAAW;AAACQ,IAAAA,cAAc,GAACR,CAAf;AAAiB;AAA7C,CAAjD,EAAgG,CAAhG;AAAmG,IAAIS,sBAAJ,EAA2BC,WAA3B;AAAuCb,MAAM,CAACC,IAAP,CAAY,8BAAZ,EAA2C;AAACW,EAAAA,sBAAsB,EAAC,UAAST,CAAT,EAAW;AAACS,IAAAA,sBAAsB,GAACT,CAAvB;AAAyB,GAA7D;AAA8DU,EAAAA,WAAW,EAAC,UAASV,CAAT,EAAW;AAACU,IAAAA,WAAW,GAACV,CAAZ;AAAc;AAApG,CAA3C,EAAiJ,CAAjJ;AAAoJ,IAAIW,SAAJ;AAAcd,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACW,IAAAA,SAAS,GAACX,CAAV;AAAY;AAAjC,CAA1C,EAA6E,CAA7E;AAAgF,IAAIY,kBAAJ;AAAuBf,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACY,IAAAA,kBAAkB,GAACZ,CAAnB;AAAqB;AAA1C,CAAnD,EAA+F,CAA/F;AAAkG,IAAIa,iBAAJ;AAAsBhB,MAAM,CAACC,IAAP,CAAY,kBAAZ,EAA+B;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACa,IAAAA,iBAAiB,GAACb,CAAlB;AAAoB;AAAzC,CAA/B,EAA0E,CAA1E;AAA6E,IAAIc,cAAJ;AAAmBjB,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACc,IAAAA,cAAc,GAACd,CAAf;AAAiB;AAAtC,CAAnC,EAA2E,CAA3E;AAA8E,IAAIe,SAAJ;AAAclB,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACe,IAAAA,SAAS,GAACf,CAAV;AAAY;AAAjC,CAA9B,EAAiE,CAAjE;AAAoE,IAAIgB,gBAAJ;AAAqBnB,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACgB,IAAAA,gBAAgB,GAAChB,CAAjB;AAAmB;AAAxC,CAArC,EAA+E,CAA/E;AAAkF,IAAIiB,OAAJ;AAAYpB,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACiB,IAAAA,OAAO,GAACjB,CAAR;AAAU;AAA/B,CAA5B,EAA6D,CAA7D;AAAgE,IAAIkB,gBAAJ;AAAqBrB,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACkB,IAAAA,gBAAgB,GAAClB,CAAjB;AAAmB;AAAxC,CAArC,EAA+E,EAA/E;AAevlC,IAAMmB,uBAAuB,GAAGL,cAAc,CAACI,gBAAD,EAAmB,GAAnB,CAA9C;AACA,IAAME,gBAAgB,GAAGN,cAAc,CAACH,SAAD,EAAY,GAAZ,CAAvC;AAEA,IAAIU,kBAAkB,GAAG,KAAzB;;IAEqBf,I;;;;;;;;;;;SACnBgB,qB;AAAA,mCAAsBC,SAAtB,EAAiCC,SAAjC,EAA4C;AAC1C,aAAO,CAACC,CAAC,CAACC,OAAF,CAAU,KAAKC,KAAf,EAAsBJ,SAAtB,CAAR;AACD;;;;;SAEDK,M;AAAA,sBAAS;AAAA,wBAYH,KAAKD,KAZF;AAAA,UAELE,OAFK,eAELA,OAFK;AAAA,UAGLC,SAHK,eAGLA,SAHK;AAAA,UAILC,SAJK,eAILA,SAJK;AAAA,UAKLC,KALK,eAKLA,KALK;AAAA,UAMLC,UANK,eAMLA,UANK;AAAA,UAOLC,OAPK,eAOLA,OAPK;AAAA,UAQLC,KARK,eAQLA,KARK;AAAA,UASLC,SATK,eASLA,SATK;AAAA,UAULC,UAVK,eAULA,UAVK;AAAA,UAWFC,IAXE;;AAAA,UAaCC,OAbD,GAamDD,IAbnD,CAaCC,OAbD;AAAA,UAaUC,QAbV,GAamDF,IAbnD,CAaUE,QAbV;AAAA,UAaoBC,IAbpB,GAamDH,IAbnD,CAaoBG,IAbpB;AAAA,UAa0BC,MAb1B,GAamDJ,IAbnD,CAa0BI,MAb1B;AAAA,UAakCC,KAblC,GAamDL,IAbnD,CAakCK,KAblC;AAAA,UAayCC,KAbzC,GAamDN,IAbnD,CAayCM,KAbzC;;AAeP,UAAIf,OAAJ,EAAa;AACX,4BAAO,oBAAC,OAAD,OAAP;AACD;;AAED,UAAIa,MAAM,CAACG,MAAX,EAAmB;AACjB,4BACE,oBAAC,SAAD,eACMP,IADN;AAEE,UAAA,KAAK,EAAEF,SAAS,CAACK,IAAI,IAAIX,SAAT,EAAoBY,MAApB,CAFlB;AAGE,UAAA,IAAI,EAAED,IAAI,IAAIX,SAHhB;AAIE,UAAA,MAAM,EAAEY,MAJV;AAKE,UAAA,QAAQ,EAAE,UAACI,QAAD,EAAWC,IAAX,EAAoB;AAC5B,gBAAMC,QAAQ,GAAGN,MAAM,CAACO,GAAxB;AACAxC,YAAAA,sBAAsB,CAACyC,IAAvB,CAA4B;AAAEF,cAAAA,QAAQ,EAARA,QAAF;AAAYF,cAAAA,QAAQ,EAARA;AAAZ,aAA5B,EAF4B,CAG5B;AACA;;AACA,gBAAIC,IAAI,IAAI,CAACA,IAAI,CAACI,WAAlB,EAA+B;AAC7B,kBAAI;AACF,oBAAMC,OAAO,GAAGC,IAAI,CAACC,SAAL,CAAeP,IAAf,CAAhB;AACAvC,gBAAAA,cAAc,CAAC0C,IAAf,CAAoB;AAClBF,kBAAAA,QAAQ,EAARA,QADkB;AAElBD,kBAAAA,IAAI,EAAEK,OAFY;AAGlBG,kBAAAA,MAAM,EAAEd,IAAI,IAAIA,IAAI,CAACQ,GAHH;AAIlBO,kBAAAA,WAAW,EAAEf,IAAI,GAAG,IAAH,GAAUX,SAAS,IAAIA,SAAS,CAACmB;AAJhC,iBAApB;AAMD,eARD,CAQE,OAAOQ,CAAP,EAAU;AACVC,gBAAAA,OAAO,CAACC,KAAR,CAAc,4CAAd,EAA4DF,CAA5D;AACD;AACF;AACF;AAvBH,WADF;AA2BD;;AAED,UAAI,CAAChB,IAAL,EAAW;AACT,YAAIpB,kBAAJ,EAAwB;AACtB,8BAAO,oBAAC,OAAD,OAAP;AACD;;AAED,YAAIqB,MAAM,CAACkB,OAAX,EAAoB;AAClB,cAAMC,cAAc,qBACfvB,IADe;AAElBR,YAAAA,SAAS,EAATA,SAFkB;AAGlBW,YAAAA,IAAI,EAAEX,SAHY;AAIlBC,YAAAA,SAAS,EAATA,SAJkB;AAKlBW,YAAAA,MAAM,EAANA;AALkB,YAApB;;AAQA,8BACE,oBAAC,kBAAD,EAAwBmB,cAAxB,EACG1B,KAAK,gBACJ,oBAAC,KAAD,EAAW0B,cAAX,CADI,gBAGJ,oBAAC,gBAAD,EAAsBA,cAAtB,CAJJ,CADF;AASD;;AAED,4BACE,oBAAC,gBAAD,eACMvB,IADN;AAEE,UAAA,UAAU,EAAED,UAFd;AAGE,UAAA,SAAS,EAAEN,SAHb;AAIE,UAAA,MAAM,EAAEW,MAJV;AAKE,UAAA,MAAM,EAAE,YAAM;AACZrB,YAAAA,kBAAkB,GAAG,IAArB;AACAX,YAAAA,WAAW,CAACwC,IAAZ,CAAiB;AAAED,cAAAA,GAAG,EAAEP,MAAM,CAACO;AAAd,aAAjB,EAAsC,YAAM;AAC1C5B,cAAAA,kBAAkB,GAAG,KAArB;AACD,aAFD;AAGD;AAVH,WADF;AAcD;;AAED,UAAIyC,OAAJ;;AACA,UAAItB,QAAQ,IAAI,CAACD,OAAjB,EAA0B;AACxB,YAAIL,OAAJ,EAAa;AACX4B,UAAAA,OAAO,gBAAG,oBAAC,OAAD,OAAV;AACD,SAFD,MAEO,IAAI/B,SAAS,CAACgC,MAAV,CAAiB,aAAjB,EAAgCC,KAAhC,KAA0C,CAA9C,EAAiD;AACtDF,UAAAA,OAAO,gBAAG,oBAAC,OAAD,OAAV;AACD,SAFM,MAEA;AACLA,UAAAA,OAAO,gBAAG,oBAAC,uBAAD,OAAV;AACD;AACF,OARD,MAQO;AACLA,QAAAA,OAAO,gBAAG,oBAAC,KAAD,EAAWxB,IAAX,CAAV;AACD;;AAED,UAAM2B,EAAE,GAAGhC,UAAU,KAAKiC,SAAf,GAA2BjC,UAA3B,GAAwCpB,iBAAnD;AACA,UAAMsD,UAAU,GAAGF,EAAE,iBACnB,oBAAC,EAAD;AAAI,QAAA,IAAI,EAAExB,IAAV;AAAgB,QAAA,MAAM,EAAEC,MAAxB;AAAgC,QAAA,KAAK,EAAEC,KAAvC;AAA8C,QAAA,KAAK,EAAEC;AAArD,QADF;AAIA,0BACE;AAAK,QAAA,SAAS,EAAC;AAAf,SACGuB,UADH,EAEGL,OAFH,CADF;AAMD;;;;;;EAvH+BvD,KAAK,CAAC6D,S","sourcesContent":["import React from \"react\";\nimport { addPlayerInput } from \"../../api/player-inputs/methods.js\";\nimport {\n  markPlayerExitStepDone,\n  playerReady\n} from \"../../api/players/methods.js\";\nimport GameLobby from \"../components/GameLobby.jsx\";\nimport GameLobbyContainer from \"../containers/GameLobbyContainer.jsx\";\nimport DefaultBreadcrumb from \"./Breadcrumb.jsx\";\nimport DelayedDisplay from \"./DelayedDisplay.jsx\";\nimport ExitSteps from \"./ExitSteps.jsx\";\nimport InstructionSteps from \"./InstructionSteps.jsx\";\nimport Loading from \"./Loading.jsx\";\nimport WaitingForServer from \"./WaitingForServer.jsx\";\n\nconst DelayedWaitingForServer = DelayedDisplay(WaitingForServer, 250);\nconst DelayedGameLobby = DelayedDisplay(GameLobby, 250);\n\nlet playerReadyClicked = false;\n\nexport default class Game extends React.Component {\n  shouldComponentUpdate(nextProps, nextState) {\n    return !_.isEqual(this.props, nextProps);\n  }\n\n  render() {\n    const {\n      loading,\n      gameLobby,\n      treatment,\n      Round,\n      Breadcrumb,\n      Waiting,\n      Lobby,\n      exitSteps,\n      introSteps,\n      ...rest\n    } = this.props;\n    const { started, timedOut, game, player, round, stage } = rest;\n\n    if (loading) {\n      return <Loading />;\n    }\n\n    if (player.exitAt) {\n      return (\n        <ExitSteps\n          {...rest}\n          steps={exitSteps(game || gameLobby, player)}\n          game={game || gameLobby}\n          player={player}\n          onSubmit={(stepName, data) => {\n            const playerId = player._id;\n            markPlayerExitStepDone.call({ playerId, stepName });\n            // Checkig for data.nativeEvent, as that indicates the data is an\n            // event object dispached by React.\n            if (data && !data.nativeEvent) {\n              try {\n                const encoded = JSON.stringify(data);\n                addPlayerInput.call({\n                  playerId,\n                  data: encoded,\n                  gameId: game && game._id,\n                  gameLobbyId: game ? null : gameLobby && gameLobby._id\n                });\n              } catch (e) {\n                console.error(\"could not encode data returned by onSubmit\", e);\n              }\n            }\n          }}\n        />\n      );\n    }\n\n    if (!game) {\n      if (playerReadyClicked) {\n        return <Loading />;\n      }\n\n      if (player.readyAt) {\n        const gameLobbyProps = {\n          ...rest,\n          gameLobby,\n          game: gameLobby,\n          treatment,\n          player\n        };\n\n        return (\n          <GameLobbyContainer {...gameLobbyProps}>\n            {Lobby ? (\n              <Lobby {...gameLobbyProps} />\n            ) : (\n              <DelayedGameLobby {...gameLobbyProps} />\n            )}\n          </GameLobbyContainer>\n        );\n      }\n\n      return (\n        <InstructionSteps\n          {...rest}\n          introSteps={introSteps}\n          treatment={treatment}\n          player={player}\n          onDone={() => {\n            playerReadyClicked = true;\n            playerReady.call({ _id: player._id }, () => {\n              playerReadyClicked = false;\n            });\n          }}\n        />\n      );\n    }\n\n    let content;\n    if (timedOut || !started) {\n      if (Waiting) {\n        content = <Waiting />;\n      } else if (treatment.factor(\"playerCount\").value === 1) {\n        content = <Loading />;\n      } else {\n        content = <DelayedWaitingForServer />;\n      }\n    } else {\n      content = <Round {...rest} />;\n    }\n\n    const BC = Breadcrumb !== undefined ? Breadcrumb : DefaultBreadcrumb;\n    const breadcrumb = BC && (\n      <BC game={game} player={player} round={round} stage={stage} />\n    );\n\n    return (\n      <div className=\"game\">\n        {breadcrumb}\n        {content}\n      </div>\n    );\n  }\n}\n"]},"sourceType":"module","hash":"4b053f1922e36091aa7427e03b7e1fe3084b157b"}
