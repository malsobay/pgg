{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/admin/AdminPlayers.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/empirica:core/ui/components/admin/AdminPlayers.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/admin/AdminPlayers.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/admin/AdminPlayers.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/components/admin/AdminPlayers.jsx"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  default: () => AdminPlayers\n});\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n\n}, 0);\nlet moment;\nmodule.link(\"moment\", {\n  default(v) {\n    moment = v;\n  }\n\n}, 1);\nlet Link;\nmodule.link(\"react-router-dom\", {\n  Link(v) {\n    Link = v;\n  }\n\n}, 2);\nlet Button, FormGroup, HTMLSelect, Intent, NonIdealState, Tag, HTMLTable, Classes;\nmodule.link(\"@blueprintjs/core\", {\n  Button(v) {\n    Button = v;\n  },\n\n  FormGroup(v) {\n    FormGroup = v;\n  },\n\n  HTMLSelect(v) {\n    HTMLSelect = v;\n  },\n\n  Intent(v) {\n    Intent = v;\n  },\n\n  NonIdealState(v) {\n    NonIdealState = v;\n  },\n\n  Tag(v) {\n    Tag = v;\n  },\n\n  HTMLTable(v) {\n    HTMLTable = v;\n  },\n\n  Classes(v) {\n    Classes = v;\n  }\n\n}, 3);\nlet IconNames;\nmodule.link(\"@blueprintjs/icons\", {\n  IconNames(v) {\n    IconNames = v;\n  }\n\n}, 4);\nlet AdminPageHeader;\nmodule.link(\"./AdminHeading.jsx\", {\n  AdminPageHeader(v) {\n    AdminPageHeader = v;\n  }\n\n}, 5);\nlet AlertToaster, SuccessToaster;\nmodule.link(\"../Toasters.jsx\", {\n  AlertToaster(v) {\n    AlertToaster = v;\n  },\n\n  SuccessToaster(v) {\n    SuccessToaster = v;\n  }\n\n}, 6);\nlet retireGameFullPlayers, retireSinglePlayer;\nmodule.link(\"../../../api/players/methods\", {\n  retireGameFullPlayers(v) {\n    retireGameFullPlayers = v;\n  },\n\n  retireSinglePlayer(v) {\n    retireSinglePlayer = v;\n  }\n\n}, 7);\nlet exitStatuses;\nmodule.link(\"../../../api/players/players.js\", {\n  exitStatuses(v) {\n    exitStatuses = v;\n  }\n\n}, 8);\n\nclass AdminPlayers extends React.Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      retiredReason: exitStatuses[0],\n      players: [],\n      searchParam: {\n        id: \"\",\n        createdAt: \"\",\n        status: \"\",\n        exitStatus: \"\"\n      }\n    };\n\n    this.handleChange = event => {\n      const retiredReason = event.currentTarget.value;\n      this.setState({\n        retiredReason\n      });\n    };\n\n    this.handleRetirePlayers = event => {\n      event.preventDefault();\n      const {\n        retiredReason\n      } = this.state;\n      retireGameFullPlayers.call({\n        retiredReason\n      }, (err, playersAffected) => {\n        if (err) {\n          AlertToaster.show({\n            message: \"Failed to retire players: \".concat(err)\n          });\n        } else {\n          SuccessToaster.show({\n            message: \"\".concat(playersAffected, \" players affected\")\n          });\n        }\n      });\n    };\n\n    this.handleRetireSinglePlayer = (event, playerId) => {\n      event.preventDefault();\n      retireSinglePlayer.call({\n        playerId\n      }, (err, _) => {\n        if (err) {\n          AlertToaster.show({\n            message: \"Failed to retire player: \".concat(err)\n          });\n        } else {\n          SuccessToaster.show({\n            message: \"Succeed to retire player\"\n          });\n        }\n      });\n    };\n\n    this.handleColumnHeaderChange = (event, key) => {\n      const value = event.currentTarget.value;\n      this.setState({\n        searchParam: _objectSpread({}, this.state.searchParam, {\n          [key]: value\n        })\n      }, this.filterPlayers);\n    };\n\n    this.filterPlayers = () => {\n      const {\n        searchParam: {\n          createdAt,\n          id,\n          status,\n          exitStatus\n        }\n      } = this.state;\n      const {\n        players\n      } = this.props;\n      this.setState({\n        players: players.filter(p => {\n          // Filter id\n          if (!id) {\n            return true;\n          }\n\n          return p.id.includes(id);\n        }).filter(p => {\n          // Filter status\n          if (!status) {\n            return true;\n          }\n\n          switch (status) {\n            case \"online\":\n              return p.online && p.idle === false;\n\n            case \"offline\":\n              return !p.online;\n\n            case \"idle\":\n              return p.idle;\n\n            default:\n              return true;\n          }\n        }).filter(p => {\n          // Filter createdAt\n          if (!createdAt) {\n            return true;\n          }\n\n          const fromNow = moment(p.createdAt).fromNow();\n          return fromNow.includes(createdAt);\n        }).filter(p => {\n          // Filter exitStatus\n          if (!exitStatus) {\n            return true;\n          }\n\n          return p.exitStatus ? p.exitStatus.includes(exitStatus) : false;\n        })\n      });\n    };\n  }\n\n  componentDidMount() {\n    const {\n      players\n    } = this.props;\n    this.setState({\n      players: players\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      players\n    } = this.props;\n\n    if (prevProps.players.length !== players.length) {\n      this.setState({\n        players: players\n      });\n    }\n  }\n\n  render() {\n    const {\n      retired\n    } = this.props;\n    const {\n      retiredReason,\n      players,\n      searchParam\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"players\"\n    }, /*#__PURE__*/React.createElement(AdminPageHeader, {\n      icon: IconNames.PERSON\n    }, retired ? \"Retired Players\" : \"Players\"), this.props.players.length === 0 ? /*#__PURE__*/React.createElement(\"p\", null, retired ? \"No retired players.\" : \"No players yet.\") : /*#__PURE__*/React.createElement(HTMLTable, {\n      striped: true\n    }, /*#__PURE__*/React.createElement(\"thead\", null, /*#__PURE__*/React.createElement(\"tr\", null, /*#__PURE__*/React.createElement(\"th\", null, \"#\"), /*#__PURE__*/React.createElement(\"th\", null, /*#__PURE__*/React.createElement(\"input\", {\n      className: Classes.INPUT,\n      value: searchParam.id,\n      type: \"text\",\n      placeholder: \"ID\",\n      onChange: e => this.handleColumnHeaderChange(e, \"id\")\n    })), /*#__PURE__*/React.createElement(\"th\", null, /*#__PURE__*/React.createElement(\"input\", {\n      className: Classes.INPUT,\n      value: searchParam.status,\n      type: \"text\",\n      placeholder: \"Status\",\n      onChange: e => this.handleColumnHeaderChange(e, \"status\")\n    })), /*#__PURE__*/React.createElement(\"th\", null, /*#__PURE__*/React.createElement(\"input\", {\n      className: Classes.INPUT,\n      value: searchParam.createdAt,\n      type: \"text\",\n      placeholder: \"First Registered\",\n      onChange: e => this.handleColumnHeaderChange(e, \"createdAt\")\n    })), /*#__PURE__*/React.createElement(\"th\", null, /*#__PURE__*/React.createElement(\"input\", {\n      className: Classes.INPUT,\n      value: searchParam.exitStatus,\n      type: \"text\",\n      placeholder: \"Exit Status\",\n      onChange: e => this.handleColumnHeaderChange(e, \"exitStatus\")\n    })), /*#__PURE__*/React.createElement(\"th\", null))), /*#__PURE__*/React.createElement(\"tbody\", null, _.map(players, player => /*#__PURE__*/React.createElement(\"tr\", {\n      key: player._id\n    }, /*#__PURE__*/React.createElement(\"td\", null, player.index), /*#__PURE__*/React.createElement(\"td\", null, player.id), /*#__PURE__*/React.createElement(\"td\", null, /*#__PURE__*/React.createElement(Tag, {\n      intent: player.online ? player.idle ? Intent.WARNING : Intent.SUCCESS : Intent.DANGER\n    }, player.online ? player.idle ? \"idle\" : \"online\" : \"offline\")), /*#__PURE__*/React.createElement(\"td\", {\n      title: moment(player.createdAt).format()\n    }, moment(player.createdAt).fromNow()), /*#__PURE__*/React.createElement(\"td\", null, player.exitStatus), /*#__PURE__*/React.createElement(\"td\", null, !player.retireAt && /*#__PURE__*/React.createElement(Button, {\n      text: \"Retire\",\n      className: Classes.SMALL,\n      minimal: true,\n      icon: IconNames.LOG_OUT,\n      intent: Intent.DANGER,\n      onClick: e => this.handleRetireSinglePlayer(e, player._id)\n    })))))), retired ? /*#__PURE__*/React.createElement(\"p\", null, /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(Link, {\n      to: \"/admin/players\"\n    }, \"Back to Active Players\")) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"p\", null, /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(Link, {\n      to: \"/admin/players/retired\"\n    }, \"View Retired Players\")), /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"h4\", null, \"Retire Players\"), /*#__PURE__*/React.createElement(FormGroup, {\n      label: \"Exit Status\",\n      labelFor: \"retire\"\n    }, /*#__PURE__*/React.createElement(HTMLSelect, {\n      name: \"retire\",\n      id: \"retire\",\n      onChange: this.handleChange,\n      value: retiredReason\n    }, _.map(exitStatuses, name => /*#__PURE__*/React.createElement(\"option\", {\n      key: name,\n      value: name\n    }, name))), /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(Button, {\n      intent: Intent.PRIMARY,\n      onClick: this.handleRetirePlayers\n    }, \"Retire Players with exitStatus \", /*#__PURE__*/React.createElement(\"strong\", null, retiredReason)))));\n  }\n\n}","map":{"version":3,"sources":["packages/empirica:core/ui/components/admin/AdminPlayers.jsx"],"names":["_objectSpread","module","link","default","v","export","AdminPlayers","React","moment","Link","Button","FormGroup","HTMLSelect","Intent","NonIdealState","Tag","HTMLTable","Classes","IconNames","AdminPageHeader","AlertToaster","SuccessToaster","retireGameFullPlayers","retireSinglePlayer","exitStatuses","Component","state","retiredReason","players","searchParam","id","createdAt","status","exitStatus","handleChange","event","currentTarget","value","setState","handleRetirePlayers","preventDefault","call","err","playersAffected","show","message","handleRetireSinglePlayer","playerId","_","handleColumnHeaderChange","key","filterPlayers","props","filter","p","includes","online","idle","fromNow","componentDidMount","componentDidUpdate","prevProps","length","render","retired","PERSON","INPUT","e","map","player","_id","index","WARNING","SUCCESS","DANGER","format","retireAt","SMALL","LOG_OUT","name","PRIMARY"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport moment from \"moment\";\nimport { Link } from \"react-router-dom\";\n\nimport {\n  Button,\n  FormGroup,\n  HTMLSelect,\n  Intent,\n  NonIdealState,\n  Tag,\n  HTMLTable,\n  Classes\n} from \"@blueprintjs/core\";\nimport { IconNames } from \"@blueprintjs/icons\";\n\nimport { AdminPageHeader } from \"./AdminHeading.jsx\";\nimport { AlertToaster, SuccessToaster } from \"../Toasters.jsx\";\nimport {\n  retireGameFullPlayers,\n  retireSinglePlayer\n} from \"../../../api/players/methods\";\nimport { exitStatuses } from \"../../../api/players/players.js\";\n\nexport default class AdminPlayers extends React.Component {\n  state = {\n    retiredReason: exitStatuses[0],\n    players: [],\n    searchParam: { id: \"\", createdAt: \"\", status: \"\", exitStatus: \"\" }\n  };\n\n  componentDidMount() {\n    const { players } = this.props;\n    this.setState({\n      players: players\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    const { players } = this.props;\n\n    if (prevProps.players.length !== players.length) {\n      this.setState({\n        players: players\n      });\n    }\n  }\n\n  handleChange = event => {\n    const retiredReason = event.currentTarget.value;\n    this.setState({\n      retiredReason\n    });\n  };\n\n  handleRetirePlayers = event => {\n    event.preventDefault();\n    const { retiredReason } = this.state;\n    retireGameFullPlayers.call({ retiredReason }, (err, playersAffected) => {\n      if (err) {\n        AlertToaster.show({ message: `Failed to retire players: ${err}` });\n      } else {\n        SuccessToaster.show({ message: `${playersAffected} players affected` });\n      }\n    });\n  };\n\n  handleRetireSinglePlayer = (event, playerId) => {\n    event.preventDefault();\n    retireSinglePlayer.call({ playerId }, (err, _) => {\n      if (err) {\n        AlertToaster.show({ message: `Failed to retire player: ${err}` });\n      } else {\n        SuccessToaster.show({\n          message: `Succeed to retire player`\n        });\n      }\n    });\n  };\n\n  handleColumnHeaderChange = (event, key) => {\n    const value = event.currentTarget.value;\n\n    this.setState(\n      {\n        searchParam: { ...this.state.searchParam, [key]: value }\n      },\n      this.filterPlayers\n    );\n  };\n\n  filterPlayers = () => {\n    const {\n      searchParam: { createdAt, id, status, exitStatus }\n    } = this.state;\n    const { players } = this.props;\n\n    this.setState({\n      players: players\n        .filter(p => {\n          // Filter id\n          if (!id) {\n            return true;\n          }\n\n          return p.id.includes(id);\n        })\n        .filter(p => {\n          // Filter status\n          if (!status) {\n            return true;\n          }\n\n          switch (status) {\n            case \"online\":\n              return p.online && p.idle === false;\n\n            case \"offline\":\n              return !p.online;\n\n            case \"idle\":\n              return p.idle;\n\n            default:\n              return true;\n          }\n        })\n        .filter(p => {\n          // Filter createdAt\n          if (!createdAt) {\n            return true;\n          }\n\n          const fromNow = moment(p.createdAt).fromNow();\n          return fromNow.includes(createdAt);\n        })\n        .filter(p => {\n          // Filter exitStatus\n          if (!exitStatus) {\n            return true;\n          }\n\n          return p.exitStatus ? p.exitStatus.includes(exitStatus) : false;\n        })\n    });\n  };\n\n  render() {\n    const { retired } = this.props;\n    const { retiredReason, players, searchParam } = this.state;\n\n    return (\n      <div className=\"players\">\n        <AdminPageHeader icon={IconNames.PERSON}>\n          {retired ? \"Retired Players\" : \"Players\"}\n        </AdminPageHeader>\n\n        {this.props.players.length === 0 ? (\n          <p>{retired ? \"No retired players.\" : \"No players yet.\"}</p>\n        ) : (\n          <HTMLTable striped>\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>\n                  <input\n                    className={Classes.INPUT}\n                    value={searchParam.id}\n                    type=\"text\"\n                    placeholder=\"ID\"\n                    onChange={e => this.handleColumnHeaderChange(e, \"id\")}\n                  />\n                </th>\n                <th>\n                  <input\n                    className={Classes.INPUT}\n                    value={searchParam.status}\n                    type=\"text\"\n                    placeholder=\"Status\"\n                    onChange={e => this.handleColumnHeaderChange(e, \"status\")}\n                  />\n                </th>\n                <th>\n                  <input\n                    className={Classes.INPUT}\n                    value={searchParam.createdAt}\n                    type=\"text\"\n                    placeholder=\"First Registered\"\n                    onChange={e =>\n                      this.handleColumnHeaderChange(e, \"createdAt\")\n                    }\n                  />\n                </th>\n                <th>\n                  <input\n                    className={Classes.INPUT}\n                    value={searchParam.exitStatus}\n                    type=\"text\"\n                    placeholder=\"Exit Status\"\n                    onChange={e =>\n                      this.handleColumnHeaderChange(e, \"exitStatus\")\n                    }\n                  />\n                </th>\n                <th />\n              </tr>\n            </thead>\n            <tbody>\n              {_.map(players, player => (\n                <tr key={player._id}>\n                  <td>{player.index}</td>\n                  <td>{player.id}</td>\n                  <td>\n                    <Tag\n                      intent={\n                        player.online\n                          ? player.idle\n                            ? Intent.WARNING\n                            : Intent.SUCCESS\n                          : Intent.DANGER\n                      }\n                    >\n                      {player.online\n                        ? player.idle\n                          ? \"idle\"\n                          : \"online\"\n                        : \"offline\"}\n                    </Tag>\n                  </td>\n                  <td title={moment(player.createdAt).format()}>\n                    {moment(player.createdAt).fromNow()}\n                  </td>\n                  <td>{player.exitStatus}</td>\n                  <td>\n                    {!player.retireAt && (\n                      <Button\n                        text={\"Retire\"}\n                        className={Classes.SMALL}\n                        minimal\n                        icon={IconNames.LOG_OUT}\n                        intent={Intent.DANGER}\n                        onClick={e =>\n                          this.handleRetireSinglePlayer(e, player._id)\n                        }\n                      />\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </HTMLTable>\n        )}\n\n        {retired ? (\n          <p>\n            <br />\n            <Link to=\"/admin/players\">Back to Active Players</Link>\n          </p>\n        ) : (\n          <>\n            <br />\n\n            <p>\n              <br />\n              <Link to=\"/admin/players/retired\">View Retired Players</Link>\n            </p>\n\n            <br />\n\n            <br />\n\n            <h4>Retire Players</h4>\n\n            <FormGroup label=\"Exit Status\" labelFor=\"retire\">\n              <HTMLSelect\n                name=\"retire\"\n                id=\"retire\"\n                onChange={this.handleChange}\n                value={retiredReason}\n              >\n                {_.map(exitStatuses, name => (\n                  <option key={name} value={name}>\n                    {name}\n                  </option>\n                ))}\n              </HTMLSelect>\n              <br />\n              <br />\n              <Button\n                intent={Intent.PRIMARY}\n                onClick={this.handleRetirePlayers}\n              >\n                Retire Players with exitStatus <strong>{retiredReason}</strong>\n              </Button>\n            </FormGroup>\n          </>\n        )}\n      </div>\n    );\n  }\n}\n"]},"sourceType":"module","hash":"b5296e1c340a603a39b3695ffcad810ed75e3ce4"}
