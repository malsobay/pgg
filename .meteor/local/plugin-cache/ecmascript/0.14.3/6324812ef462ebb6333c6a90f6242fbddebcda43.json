{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/empirica:core/ui/containers/IdentifiedContainer.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/containers/IdentifiedContainer.jsx"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\n\nlet _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 1);\nmodule.export({\n  getPlayerId: () => getPlayerId,\n  setPlayerId: () => setPlayerId,\n  removePlayerId: () => removePlayerId\n});\nlet withTracker;\nmodule.link(\"meteor/react-meteor-data\", {\n  withTracker(v) {\n    withTracker = v;\n  }\n\n}, 0);\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n\n}, 1);\nlet Players;\nmodule.link(\"../../api/players/players.js\", {\n  Players(v) {\n    Players = v;\n  }\n\n}, 2);\nlet playerWasRetired;\nmodule.link(\"../../api/players/methods.js\", {\n  playerWasRetired(v) {\n    playerWasRetired = v;\n  }\n\n}, 3);\nconst defaultPlayerIdKey = \"d4900a09cf1f41a494d4fc32a626dfef\";\nconst urlParams = new URLSearchParams(window.location.search);\nlet playerIdKeyOverride = urlParams.get(\"playerIdKey\");\n\nif (playerIdKeyOverride) {\n  playerIdKeyOverride += \"-\" + defaultPlayerIdKey;\n}\n\nconst playerIdKey = playerIdKeyOverride || defaultPlayerIdKey;\nconst playerIdDep = new Tracker.Dependency();\n\nconst getPlayerId = () => {\n  playerIdDep.depend();\n  return localStorage.getItem(playerIdKey);\n};\n\nconst setPlayerId = playerId => {\n  if (!playerId) {\n    // Avoid storing falsey value\n    return;\n  }\n\n  const existing = localStorage.getItem(playerIdKey);\n\n  if (existing === playerId) {\n    return;\n  }\n\n  localStorage.setItem(playerIdKey, playerId);\n  playerIdDep.changed();\n};\n\nconst removePlayerId = () => {\n  localStorage.removeItem(playerIdKey);\n  playerIdDep.changed();\n};\n\nmodule.exportDefault((Component, props) => {\n  class IdentifiedContainerInner extends React.Component {\n    componentDidMount() {\n      const {\n        playerId: _id\n      } = this.props;\n\n      if (_id) {\n        playerWasRetired.call({\n          _id\n        }, (err, wasRetired) => {\n          if (!err && wasRetired) {\n            removePlayerId();\n          }\n        });\n      }\n    }\n\n    render() {\n      return /*#__PURE__*/React.createElement(Component, _extends({}, this.props, props));\n    }\n\n  }\n\n  const HasPlayers = new Mongo.Collection(\"hasPlayers\");\n  let hasPlayers = false;\n  return withTracker(rest => {\n    const playerId = getPlayerId();\n    const loading = !Meteor.subscribe(\"playerInfo\", {\n      playerId\n    }).ready();\n    const player = Players.findOne(); // We load a flag telling us if the players were cleared, if so remove the\n    // playerId from the local store.\n\n    const hasPlayersObj = HasPlayers.findOne();\n\n    if (hasPlayersObj) {\n      if (hasPlayersObj.hasPlayers === false && hasPlayers === true) {\n        console.info(\"clearing player: (\".concat(playerId, \")\"));\n        removePlayerId();\n      }\n\n      hasPlayers = hasPlayersObj.hasPlayers;\n    }\n\n    return _objectSpread({}, rest, {\n      loading,\n      playerId,\n      player,\n      connected: Meteor.status().connected,\n      playerIdKey: (playerIdKeyOverride || \"\").slice(0, 5)\n    });\n  })(IdentifiedContainerInner);\n});","map":{"version":3,"sources":["packages/empirica:core/ui/containers/IdentifiedContainer.jsx"],"names":["_objectSpread","module","link","default","v","_extends","export","getPlayerId","setPlayerId","removePlayerId","withTracker","React","Players","playerWasRetired","defaultPlayerIdKey","urlParams","URLSearchParams","window","location","search","playerIdKeyOverride","get","playerIdKey","playerIdDep","Tracker","Dependency","depend","localStorage","getItem","playerId","existing","setItem","changed","removeItem","exportDefault","Component","props","IdentifiedContainerInner","componentDidMount","_id","call","err","wasRetired","render","HasPlayers","Mongo","Collection","hasPlayers","rest","loading","Meteor","subscribe","ready","player","findOne","hasPlayersObj","console","info","connected","status","slice"],"mappings":"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","sourcesContent":["import { withTracker } from \"meteor/react-meteor-data\";\nimport React from \"react\";\n\nimport { Players } from \"../../api/players/players.js\";\nimport { playerWasRetired } from \"../../api/players/methods.js\";\n\nconst defaultPlayerIdKey = \"d4900a09cf1f41a494d4fc32a626dfef\";\n\nconst urlParams = new URLSearchParams(window.location.search);\nlet playerIdKeyOverride = urlParams.get(\"playerIdKey\");\nif (playerIdKeyOverride) {\n  playerIdKeyOverride += \"-\" + defaultPlayerIdKey;\n}\n\nconst playerIdKey = playerIdKeyOverride || defaultPlayerIdKey;\nconst playerIdDep = new Tracker.Dependency();\n\nexport const getPlayerId = () => {\n  playerIdDep.depend();\n  return localStorage.getItem(playerIdKey);\n};\n\nexport const setPlayerId = playerId => {\n  if (!playerId) {\n    // Avoid storing falsey value\n    return;\n  }\n  const existing = localStorage.getItem(playerIdKey);\n  if (existing === playerId) {\n    return;\n  }\n  localStorage.setItem(playerIdKey, playerId);\n  playerIdDep.changed();\n};\n\nexport const removePlayerId = () => {\n  localStorage.removeItem(playerIdKey);\n  playerIdDep.changed();\n};\n\nexport default (Component, props) => {\n  class IdentifiedContainerInner extends React.Component {\n    componentDidMount() {\n      const { playerId: _id } = this.props;\n      if (_id) {\n        playerWasRetired.call({ _id }, (err, wasRetired) => {\n          if (!err && wasRetired) {\n            removePlayerId();\n          }\n        });\n      }\n    }\n\n    render() {\n      return <Component {...this.props} {...props} />;\n    }\n  }\n\n  const HasPlayers = new Mongo.Collection(\"hasPlayers\");\n  let hasPlayers = false;\n  return withTracker(rest => {\n    const playerId = getPlayerId();\n\n    const loading = !Meteor.subscribe(\"playerInfo\", { playerId }).ready();\n    const player = Players.findOne();\n\n    // We load a flag telling us if the players were cleared, if so remove the\n    // playerId from the local store.\n    const hasPlayersObj = HasPlayers.findOne();\n    if (hasPlayersObj) {\n      if (hasPlayersObj.hasPlayers === false && hasPlayers === true) {\n        console.info(`clearing player: (${playerId})`);\n        removePlayerId();\n      }\n      hasPlayers = hasPlayersObj.hasPlayers;\n    }\n\n    return {\n      ...rest,\n      loading,\n      playerId,\n      player,\n      connected: Meteor.status().connected,\n      playerIdKey: (playerIdKeyOverride || \"\").slice(0, 5)\n    };\n  })(IdentifiedContainerInner);\n};\n"]},"sourceType":"module","hash":"6324812ef462ebb6333c6a90f6242fbddebcda43"}
