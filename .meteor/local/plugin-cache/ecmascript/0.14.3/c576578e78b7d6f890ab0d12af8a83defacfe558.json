{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/api/server/onsubmit.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"packages/empirica:core/api/server/onsubmit.js","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/api/server/onsubmit.js","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/api/server/onsubmit.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/api/server/onsubmit.js"}},"code":"module.export({\n  callOnSubmit: () => callOnSubmit\n});\nlet shared;\nmodule.link(\"../../shared.js\", {\n  default(v) {\n    shared = v;\n  }\n\n}, 0);\nlet Games;\nmodule.link(\"../games/games.js\", {\n  Games(v) {\n    Games = v;\n  }\n\n}, 1);\nlet Players;\nmodule.link(\"../players/players.js\", {\n  Players(v) {\n    Players = v;\n  }\n\n}, 2);\nlet Rounds;\nmodule.link(\"../rounds/rounds.js\", {\n  Rounds(v) {\n    Rounds = v;\n  }\n\n}, 3);\nlet Stages;\nmodule.link(\"../stages/stages.js\", {\n  Stages(v) {\n    Stages = v;\n  }\n\n}, 4);\nlet Treatments;\nmodule.link(\"../treatments/treatments.js\", {\n  Treatments(v) {\n    Treatments = v;\n  }\n\n}, 5);\nlet augmentGameStageRound, augmentPlayerStageRound;\nmodule.link(\"../player-stages/augment.js\", {\n  augmentGameStageRound(v) {\n    augmentGameStageRound = v;\n  },\n\n  augmentPlayerStageRound(v) {\n    augmentPlayerStageRound = v;\n  }\n\n}, 6);\nlet augmentGameObject;\nmodule.link(\"../games/augment.js\", {\n  augmentGameObject(v) {\n    augmentGameObject = v;\n  }\n\n}, 7);\nlet config;\nmodule.link(\"../../server\", {\n  config(v) {\n    config = v;\n  }\n\n}, 8);\n\nconst callOnSubmit = params => {\n  const {\n    onSubmit\n  } = config;\n\n  if (!onSubmit) {\n    return;\n  }\n\n  const {\n    playerId,\n    playerStage\n  } = params;\n  const player = Players.findOne(playerId);\n  const game = Games.findOne(player.gameId);\n\n  if (!game) {\n    console.error(\"\".concat(targetType, \" data updated without game\"));\n    return;\n  }\n\n  const stage = Stages.findOne(playerStage.stageId);\n\n  if (!stage) {\n    console.error(\"\".concat(targetType, \" data updated without stage\"));\n    return;\n  }\n\n  const {\n    roundId\n  } = stage;\n  const round = Rounds.findOne(roundId);\n  const treatment = Treatments.findOne(game.treatmentId);\n  augmentGameObject({\n    game,\n    treatment,\n    round,\n    stage\n  });\n  augmentGameStageRound(game, stage, round);\n  player.stage = _.extend({}, stage);\n  player.round = _.extend({}, round);\n  augmentPlayerStageRound(player, player.stage, player.round, game);\n  onSubmit(game, round, stage, player);\n};","map":{"version":3,"sources":["packages/empirica:core/api/server/onsubmit.js"],"names":["module","export","callOnSubmit","shared","link","default","v","Games","Players","Rounds","Stages","Treatments","augmentGameStageRound","augmentPlayerStageRound","augmentGameObject","config","params","onSubmit","playerId","playerStage","player","findOne","game","gameId","console","error","targetType","stage","stageId","roundId","round","treatment","treatmentId","_","extend"],"mappings":"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","sourcesContent":["import shared from \"../../shared.js\";\nimport { Games } from \"../games/games.js\";\nimport { Players } from \"../players/players.js\";\nimport { Rounds } from \"../rounds/rounds.js\";\nimport { Stages } from \"../stages/stages.js\";\nimport { Treatments } from \"../treatments/treatments.js\";\nimport {\n  augmentGameStageRound,\n  augmentPlayerStageRound\n} from \"../player-stages/augment.js\";\nimport { augmentGameObject } from \"../games/augment.js\";\nimport { config } from \"../../server\";\n\nexport const callOnSubmit = params => {\n  const { onSubmit } = config;\n  if (!onSubmit) {\n    return;\n  }\n\n  const { playerId, playerStage } = params;\n\n  const player = Players.findOne(playerId);\n  const game = Games.findOne(player.gameId);\n  if (!game) {\n    console.error(`${targetType} data updated without game`);\n    return;\n  }\n  const stage = Stages.findOne(playerStage.stageId);\n  if (!stage) {\n    console.error(`${targetType} data updated without stage`);\n    return;\n  }\n\n  const { roundId } = stage;\n  const round = Rounds.findOne(roundId);\n  const treatment = Treatments.findOne(game.treatmentId);\n\n  augmentGameObject({ game, treatment, round, stage });\n\n  augmentGameStageRound(game, stage, round);\n\n  player.stage = _.extend({}, stage);\n  player.round = _.extend({}, round);\n  augmentPlayerStageRound(player, player.stage, player.round, game);\n\n  onSubmit(game, round, stage, player);\n};\n"]},"sourceType":"module","hash":"c576578e78b7d6f890ab0d12af8a83defacfe558"}
