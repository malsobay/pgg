{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/empirica:core/ui/containers/IdentifiedContainer.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/containers/IdentifiedContainer.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/containers/IdentifiedContainer.jsx"}},"code":"var _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\n\nvar _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 1);\n\nvar _createSuper;\n\nmodule.link(\"@babel/runtime/helpers/createSuper\", {\n  default: function (v) {\n    _createSuper = v;\n  }\n}, 2);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 3);\nmodule.export({\n  getPlayerId: function () {\n    return getPlayerId;\n  },\n  setPlayerId: function () {\n    return setPlayerId;\n  },\n  removePlayerId: function () {\n    return removePlayerId;\n  }\n});\nvar withTracker;\nmodule.link(\"meteor/react-meteor-data\", {\n  withTracker: function (v) {\n    withTracker = v;\n  }\n}, 0);\nvar React;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 1);\nvar Players;\nmodule.link(\"../../api/players/players.js\", {\n  Players: function (v) {\n    Players = v;\n  }\n}, 2);\nvar playerWasRetired;\nmodule.link(\"../../api/players/methods.js\", {\n  playerWasRetired: function (v) {\n    playerWasRetired = v;\n  }\n}, 3);\nvar defaultPlayerIdKey = \"d4900a09cf1f41a494d4fc32a626dfef\";\nvar urlParams = new URLSearchParams(window.location.search);\nvar playerIdKeyOverride = urlParams.get(\"playerIdKey\");\n\nif (playerIdKeyOverride) {\n  playerIdKeyOverride += \"-\" + defaultPlayerIdKey;\n}\n\nvar playerIdKey = playerIdKeyOverride || defaultPlayerIdKey;\nvar playerIdDep = new Tracker.Dependency();\n\nvar getPlayerId = function () {\n  playerIdDep.depend();\n  return localStorage.getItem(playerIdKey);\n};\n\nvar setPlayerId = function (playerId) {\n  if (!playerId) {\n    // Avoid storing falsey value\n    return;\n  }\n\n  var existing = localStorage.getItem(playerIdKey);\n\n  if (existing === playerId) {\n    return;\n  }\n\n  localStorage.setItem(playerIdKey, playerId);\n  playerIdDep.changed();\n};\n\nvar removePlayerId = function () {\n  localStorage.removeItem(playerIdKey);\n  playerIdDep.changed();\n};\n\nmodule.exportDefault(function (Component, props) {\n  var IdentifiedContainerInner = /*#__PURE__*/function (_React$Component) {\n    _inheritsLoose(IdentifiedContainerInner, _React$Component);\n\n    var _super = _createSuper(IdentifiedContainerInner);\n\n    function IdentifiedContainerInner() {\n      return _React$Component.apply(this, arguments) || this;\n    }\n\n    var _proto = IdentifiedContainerInner.prototype;\n\n    _proto.componentDidMount = function () {\n      function componentDidMount() {\n        var _id = this.props.playerId;\n\n        if (_id) {\n          playerWasRetired.call({\n            _id: _id\n          }, function (err, wasRetired) {\n            if (!err && wasRetired) {\n              removePlayerId();\n            }\n          });\n        }\n      }\n\n      return componentDidMount;\n    }();\n\n    _proto.render = function () {\n      function render() {\n        return /*#__PURE__*/React.createElement(Component, _extends({}, this.props, props));\n      }\n\n      return render;\n    }();\n\n    return IdentifiedContainerInner;\n  }(React.Component);\n\n  var HasPlayers = new Mongo.Collection(\"hasPlayers\");\n  var hasPlayers = false;\n  return withTracker(function (rest) {\n    var playerId = getPlayerId();\n    var loading = !Meteor.subscribe(\"playerInfo\", {\n      playerId: playerId\n    }).ready();\n    var player = Players.findOne(); // We load a flag telling us if the players were cleared, if so remove the\n    // playerId from the local store.\n\n    var hasPlayersObj = HasPlayers.findOne();\n\n    if (hasPlayersObj) {\n      if (hasPlayersObj.hasPlayers === false && hasPlayers === true) {\n        console.info(\"clearing player: (\" + playerId + \")\");\n        removePlayerId();\n      }\n\n      hasPlayers = hasPlayersObj.hasPlayers;\n    }\n\n    return _objectSpread({}, rest, {\n      loading: loading,\n      playerId: playerId,\n      player: player,\n      connected: Meteor.status().connected,\n      playerIdKey: (playerIdKeyOverride || \"\").slice(0, 5)\n    });\n  })(IdentifiedContainerInner);\n});","map":{"version":3,"sources":["packages/empirica:core/ui/containers/IdentifiedContainer.jsx"],"names":["_objectSpread","module","link","default","v","_extends","_createSuper","_inheritsLoose","export","getPlayerId","setPlayerId","removePlayerId","withTracker","React","Players","playerWasRetired","defaultPlayerIdKey","urlParams","URLSearchParams","window","location","search","playerIdKeyOverride","get","playerIdKey","playerIdDep","Tracker","Dependency","depend","localStorage","getItem","playerId","existing","setItem","changed","removeItem","exportDefault","Component","props","IdentifiedContainerInner","componentDidMount","_id","call","err","wasRetired","render","HasPlayers","Mongo","Collection","hasPlayers","rest","loading","Meteor","subscribe","ready","player","findOne","hasPlayersObj","console","info","connected","status","slice"],"mappings":"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","sourcesContent":["import { withTracker } from \"meteor/react-meteor-data\";\nimport React from \"react\";\n\nimport { Players } from \"../../api/players/players.js\";\nimport { playerWasRetired } from \"../../api/players/methods.js\";\n\nconst defaultPlayerIdKey = \"d4900a09cf1f41a494d4fc32a626dfef\";\n\nconst urlParams = new URLSearchParams(window.location.search);\nlet playerIdKeyOverride = urlParams.get(\"playerIdKey\");\nif (playerIdKeyOverride) {\n  playerIdKeyOverride += \"-\" + defaultPlayerIdKey;\n}\n\nconst playerIdKey = playerIdKeyOverride || defaultPlayerIdKey;\nconst playerIdDep = new Tracker.Dependency();\n\nexport const getPlayerId = () => {\n  playerIdDep.depend();\n  return localStorage.getItem(playerIdKey);\n};\n\nexport const setPlayerId = playerId => {\n  if (!playerId) {\n    // Avoid storing falsey value\n    return;\n  }\n  const existing = localStorage.getItem(playerIdKey);\n  if (existing === playerId) {\n    return;\n  }\n  localStorage.setItem(playerIdKey, playerId);\n  playerIdDep.changed();\n};\n\nexport const removePlayerId = () => {\n  localStorage.removeItem(playerIdKey);\n  playerIdDep.changed();\n};\n\nexport default (Component, props) => {\n  class IdentifiedContainerInner extends React.Component {\n    componentDidMount() {\n      const { playerId: _id } = this.props;\n      if (_id) {\n        playerWasRetired.call({ _id }, (err, wasRetired) => {\n          if (!err && wasRetired) {\n            removePlayerId();\n          }\n        });\n      }\n    }\n\n    render() {\n      return <Component {...this.props} {...props} />;\n    }\n  }\n\n  const HasPlayers = new Mongo.Collection(\"hasPlayers\");\n  let hasPlayers = false;\n  return withTracker(rest => {\n    const playerId = getPlayerId();\n\n    const loading = !Meteor.subscribe(\"playerInfo\", { playerId }).ready();\n    const player = Players.findOne();\n\n    // We load a flag telling us if the players were cleared, if so remove the\n    // playerId from the local store.\n    const hasPlayersObj = HasPlayers.findOne();\n    if (hasPlayersObj) {\n      if (hasPlayersObj.hasPlayers === false && hasPlayers === true) {\n        console.info(`clearing player: (${playerId})`);\n        removePlayerId();\n      }\n      hasPlayers = hasPlayersObj.hasPlayers;\n    }\n\n    return {\n      ...rest,\n      loading,\n      playerId,\n      player,\n      connected: Meteor.status().connected,\n      playerIdKey: (playerIdKeyOverride || \"\").slice(0, 5)\n    };\n  })(IdentifiedContainerInner);\n};\n"]},"sourceType":"module","hash":"e25f571db2300590c969d9ba60763586ec95a9ec"}
