{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/NewPlayer.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/empirica:core/ui/components/NewPlayer.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/NewPlayer.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/NewPlayer.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/components/NewPlayer.jsx"}},"code":"var _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 0);\n\nvar _createForOfIteratorHelperLoose;\n\nmodule.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\", {\n  default: function (v) {\n    _createForOfIteratorHelperLoose = v;\n  }\n}, 1);\n\nvar _createSuper;\n\nmodule.link(\"@babel/runtime/helpers/createSuper\", {\n  default: function (v) {\n    _createSuper = v;\n  }\n}, 2);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 3);\nmodule.export({\n  ConsentButtonContext: function () {\n    return ConsentButtonContext;\n  },\n  \"default\": function () {\n    return NewPlayer;\n  }\n});\nvar React;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 0);\nvar createPlayer;\nmodule.link(\"../../api/players/methods\", {\n  createPlayer: function (v) {\n    createPlayer = v;\n  }\n}, 1);\nvar setPlayerId;\nmodule.link(\"../containers/IdentifiedContainer.jsx\", {\n  setPlayerId: function (v) {\n    setPlayerId = v;\n  }\n}, 2);\nvar Loading;\nmodule.link(\"./Loading.jsx\", {\n  \"default\": function (v) {\n    Loading = v;\n  }\n}, 3);\nvar NewPlayerForm;\nmodule.link(\"./NewPlayerForm.jsx\", {\n  \"default\": function (v) {\n    NewPlayerForm = v;\n  }\n}, 4);\nvar AlertToaster;\nmodule.link(\"./Toasters.jsx\", {\n  AlertToaster: function (v) {\n    AlertToaster = v;\n  }\n}, 5);\nvar playerIdParam = Meteor.settings.public.playerIdParam;\nvar ConsentButtonContext = React.createContext(null);\n\nvar NewPlayer = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(NewPlayer, _React$Component);\n\n  var _super = _createSuper(NewPlayer);\n\n  function NewPlayer() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n    _this.state = {\n      consented: false\n    };\n\n    _this.handleConsent = function () {\n      _this.setState({\n        consented: true\n      });\n\n      _this.playerFromIdParam();\n    };\n\n    _this.handleNewPlayer = function (id) {\n      if (!id || !id.trim()) {\n        AlertToaster.show({\n          message: \"Player Identifier cannot be empty!\"\n        });\n        return;\n      }\n\n      var urlParams = {};\n      var searchParams = new URL(document.location).searchParams;\n\n      for (var _iterator = _createForOfIteratorHelperLoose(searchParams.entries()), _step; !(_step = _iterator()).done;) {\n        var pair = _step.value;\n        urlParams[pair[0]] = pair[1];\n      }\n\n      createPlayer.call({\n        id: id,\n        urlParams: urlParams\n      }, function (err, _id) {\n        if (err) {\n          console.error(err);\n          AlertToaster.show({\n            message: String(err)\n          });\n          return;\n        }\n\n        setPlayerId(_id);\n      });\n    };\n\n    return _this;\n  }\n\n  var _proto = NewPlayer.prototype;\n\n  _proto.componentDidUpdate = function () {\n    function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      if (this.state.consented && !prevState.consented) {\n        this.timeout = setTimeout(function () {\n          _this2.timeout = null;\n          var idField = window.document.querySelector(\"#id\");\n\n          if (idField) {\n            idField.focus();\n          }\n        }, 100);\n      }\n    }\n\n    return componentDidUpdate;\n  }();\n\n  _proto.componentWillMount = function () {\n    function componentWillMount() {\n      if (!this.props.Consent) {\n        this.playerFromIdParam();\n      }\n    }\n\n    return componentWillMount;\n  }();\n\n  _proto.componentWillUnmount = function () {\n    function componentWillUnmount() {\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n      }\n    }\n\n    return componentWillUnmount;\n  }();\n\n  _proto.playerFromIdParam = function () {\n    function playerFromIdParam() {\n      var _this3 = this;\n\n      var playerIdParam = Meteor.settings.public.playerIdParam;\n\n      if (playerIdParam) {\n        var _searchParams = new URL(document.location).searchParams;\n\n        var id = _searchParams.get(playerIdParam);\n\n        if (id) {\n          var _urlParams = {};\n\n          for (var _iterator2 = _createForOfIteratorHelperLoose(_searchParams.entries()), _step2; !(_step2 = _iterator2()).done;) {\n            var pair = _step2.value;\n            _urlParams[pair[0]] = pair[1];\n          }\n\n          this.setState({\n            attemptingAutoLogin: true\n          });\n          createPlayer.call({\n            id: id,\n            urlParams: _urlParams\n          }, function (err, _id) {\n            if (err) {\n              _this3.setState({\n                attemptingAutoLogin: false\n              });\n\n              console.error(err);\n              AlertToaster.show({\n                message: String(err)\n              });\n              return;\n            }\n\n            setPlayerId(_id);\n          });\n        }\n      }\n    }\n\n    return playerFromIdParam;\n  }();\n\n  _proto.render = function () {\n    function render() {\n      var _this$props = this.props,\n          Consent = _this$props.Consent,\n          CustomNewPlayer = _this$props.CustomNewPlayer;\n      var _this$state = this.state,\n          consented = _this$state.consented,\n          attemptingAutoLogin = _this$state.attemptingAutoLogin;\n      var Form = CustomNewPlayer || NewPlayerForm;\n\n      if (attemptingAutoLogin) {\n        return /*#__PURE__*/React.createElement(Loading, null);\n      }\n\n      if (!consented && Consent) {\n        return /*#__PURE__*/React.createElement(ConsentButtonContext.Provider, {\n          value: this.handleConsent\n        }, /*#__PURE__*/React.createElement(Consent, _extends({}, this.props, {\n          onConsent: this.handleConsent\n        })));\n      }\n\n      return /*#__PURE__*/React.createElement(Form, _extends({}, this.props, {\n        handleNewPlayer: this.handleNewPlayer\n      }));\n    }\n\n    return render;\n  }();\n\n  return NewPlayer;\n}(React.Component);","map":{"version":3,"sources":["packages/empirica:core/ui/components/NewPlayer.jsx"],"names":["_extends","module","link","default","v","_createForOfIteratorHelperLoose","_createSuper","_inheritsLoose","export","ConsentButtonContext","NewPlayer","React","createPlayer","setPlayerId","Loading","NewPlayerForm","AlertToaster","playerIdParam","Meteor","settings","public","createContext","state","consented","handleConsent","setState","playerFromIdParam","handleNewPlayer","id","trim","show","message","urlParams","searchParams","URL","document","location","entries","pair","call","err","_id","console","error","String","componentDidUpdate","prevProps","prevState","timeout","setTimeout","idField","window","querySelector","focus","componentWillMount","props","Consent","componentWillUnmount","clearTimeout","get","attemptingAutoLogin","render","CustomNewPlayer","Form","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { createPlayer } from \"../../api/players/methods\";\nimport { setPlayerId } from \"../containers/IdentifiedContainer.jsx\";\nimport Loading from \"./Loading.jsx\";\nimport NewPlayerForm from \"./NewPlayerForm.jsx\";\nimport { AlertToaster } from \"./Toasters.jsx\";\n\nconst { playerIdParam } = Meteor.settings.public;\n\nexport const ConsentButtonContext = React.createContext(null);\n\nexport default class NewPlayer extends React.Component {\n  state = { consented: false };\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.consented && !prevState.consented) {\n      this.timeout = setTimeout(() => {\n        this.timeout = null;\n        const idField = window.document.querySelector(\"#id\");\n        if (idField) {\n          idField.focus();\n        }\n      }, 100);\n    }\n  }\n\n  componentWillMount() {\n    if (!this.props.Consent) {\n      this.playerFromIdParam();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n    }\n  }\n\n  handleConsent = () => {\n    this.setState({ consented: true });\n    this.playerFromIdParam();\n  };\n\n  handleNewPlayer = id => {\n    if (!id || !id.trim()) {\n      AlertToaster.show({ message: \"Player Identifier cannot be empty!\" });\n      return;\n    }\n\n    const urlParams = {};\n    const searchParams = new URL(document.location).searchParams;\n    for (var pair of searchParams.entries()) {\n      urlParams[pair[0]] = pair[1];\n    }\n\n    createPlayer.call({ id, urlParams }, (err, _id) => {\n      if (err) {\n        console.error(err);\n        AlertToaster.show({ message: String(err) });\n        return;\n      }\n\n      setPlayerId(_id);\n    });\n  };\n\n  playerFromIdParam() {\n    const { playerIdParam } = Meteor.settings.public;\n\n    if (playerIdParam) {\n      const searchParams = new URL(document.location).searchParams;\n      const id = searchParams.get(playerIdParam);\n      if (id) {\n        const urlParams = {};\n        for (var pair of searchParams.entries()) {\n          urlParams[pair[0]] = pair[1];\n        }\n        this.setState({ attemptingAutoLogin: true });\n        createPlayer.call({ id, urlParams }, (err, _id) => {\n          if (err) {\n            this.setState({ attemptingAutoLogin: false });\n            console.error(err);\n            AlertToaster.show({ message: String(err) });\n            return;\n          }\n\n          setPlayerId(_id);\n        });\n      }\n    }\n  }\n\n  render() {\n    const { Consent, CustomNewPlayer } = this.props;\n    const { consented, attemptingAutoLogin } = this.state;\n    const Form = CustomNewPlayer || NewPlayerForm;\n\n    if (attemptingAutoLogin) {\n      return <Loading />;\n    }\n\n    if (!consented && Consent) {\n      return (\n        <ConsentButtonContext.Provider value={this.handleConsent}>\n          <Consent {...this.props} onConsent={this.handleConsent} />\n        </ConsentButtonContext.Provider>\n      );\n    }\n\n    return <Form {...this.props} handleNewPlayer={this.handleNewPlayer} />;\n  }\n}\n"]},"sourceType":"module","hash":"f8a9cc50245ff1dd45144f06d7d1168d1f17acb8"}
