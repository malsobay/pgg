{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/empirica:core/ui/components/Game.jsx","filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","passPerPreset":false,"envName":"development","cwd":"/Users/tilenbabnik/Desktop/pgg","root":"/Users/tilenbabnik/Desktop/pgg","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/tilenbabnik/Desktop/pgg/packages/empirica:core/ui/components/Game.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/empirica:core/ui/components/Game.jsx"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\n\nlet _extends;\n\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n\n}, 1);\n\nlet _objectWithoutProperties;\n\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n\n}, 2);\nmodule.export({\n  default: () => Game\n});\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n\n}, 0);\nlet addPlayerInput;\nmodule.link(\"../../api/player-inputs/methods.js\", {\n  addPlayerInput(v) {\n    addPlayerInput = v;\n  }\n\n}, 1);\nlet markPlayerExitStepDone, playerReady;\nmodule.link(\"../../api/players/methods.js\", {\n  markPlayerExitStepDone(v) {\n    markPlayerExitStepDone = v;\n  },\n\n  playerReady(v) {\n    playerReady = v;\n  }\n\n}, 2);\nlet GameLobby;\nmodule.link(\"../components/GameLobby.jsx\", {\n  default(v) {\n    GameLobby = v;\n  }\n\n}, 3);\nlet GameLobbyContainer;\nmodule.link(\"../containers/GameLobbyContainer.jsx\", {\n  default(v) {\n    GameLobbyContainer = v;\n  }\n\n}, 4);\nlet DefaultBreadcrumb;\nmodule.link(\"./Breadcrumb.jsx\", {\n  default(v) {\n    DefaultBreadcrumb = v;\n  }\n\n}, 5);\nlet DelayedDisplay;\nmodule.link(\"./DelayedDisplay.jsx\", {\n  default(v) {\n    DelayedDisplay = v;\n  }\n\n}, 6);\nlet ExitSteps;\nmodule.link(\"./ExitSteps.jsx\", {\n  default(v) {\n    ExitSteps = v;\n  }\n\n}, 7);\nlet InstructionSteps;\nmodule.link(\"./InstructionSteps.jsx\", {\n  default(v) {\n    InstructionSteps = v;\n  }\n\n}, 8);\nlet Loading;\nmodule.link(\"./Loading.jsx\", {\n  default(v) {\n    Loading = v;\n  }\n\n}, 9);\nlet WaitingForServer;\nmodule.link(\"./WaitingForServer.jsx\", {\n  default(v) {\n    WaitingForServer = v;\n  }\n\n}, 10);\nconst DelayedWaitingForServer = DelayedDisplay(WaitingForServer, 250);\nconst DelayedGameLobby = DelayedDisplay(GameLobby, 250);\nlet playerReadyClicked = false;\n\nclass Game extends React.Component {\n  shouldComponentUpdate(nextProps, nextState) {\n    return !_.isEqual(this.props, nextProps);\n  }\n\n  render() {\n    const _this$props = this.props,\n          {\n      loading,\n      gameLobby,\n      treatment,\n      Round,\n      Breadcrumb,\n      Waiting,\n      Lobby,\n      exitSteps,\n      introSteps\n    } = _this$props,\n          rest = _objectWithoutProperties(_this$props, [\"loading\", \"gameLobby\", \"treatment\", \"Round\", \"Breadcrumb\", \"Waiting\", \"Lobby\", \"exitSteps\", \"introSteps\"]);\n\n    const {\n      started,\n      timedOut,\n      game,\n      player,\n      round,\n      stage\n    } = rest;\n\n    if (loading) {\n      return /*#__PURE__*/React.createElement(Loading, null);\n    }\n\n    if (player.exitAt) {\n      return /*#__PURE__*/React.createElement(ExitSteps, _extends({}, rest, {\n        steps: exitSteps(game || gameLobby, player),\n        game: game || gameLobby,\n        player: player,\n        onSubmit: (stepName, data) => {\n          const playerId = player._id;\n          markPlayerExitStepDone.call({\n            playerId,\n            stepName\n          }); // Checkig for data.nativeEvent, as that indicates the data is an\n          // event object dispached by React.\n\n          if (data && !data.nativeEvent) {\n            try {\n              const encoded = JSON.stringify(data);\n              addPlayerInput.call({\n                playerId,\n                data: encoded,\n                gameId: game && game._id,\n                gameLobbyId: game ? null : gameLobby && gameLobby._id\n              });\n            } catch (e) {\n              console.error(\"could not encode data returned by onSubmit\", e);\n            }\n          }\n        }\n      }));\n    }\n\n    if (!game) {\n      if (playerReadyClicked) {\n        return /*#__PURE__*/React.createElement(Loading, null);\n      }\n\n      if (player.readyAt) {\n        const gameLobbyProps = _objectSpread({}, rest, {\n          gameLobby,\n          game: gameLobby,\n          treatment,\n          player\n        });\n\n        return /*#__PURE__*/React.createElement(GameLobbyContainer, gameLobbyProps, Lobby ? /*#__PURE__*/React.createElement(Lobby, gameLobbyProps) : /*#__PURE__*/React.createElement(DelayedGameLobby, gameLobbyProps));\n      }\n\n      return /*#__PURE__*/React.createElement(InstructionSteps, _extends({}, rest, {\n        introSteps: introSteps,\n        treatment: treatment,\n        player: player,\n        onDone: () => {\n          playerReadyClicked = true;\n          playerReady.call({\n            _id: player._id\n          }, () => {\n            playerReadyClicked = false;\n          });\n        }\n      }));\n    }\n\n    let content;\n\n    if (timedOut || !started) {\n      if (Waiting) {\n        content = /*#__PURE__*/React.createElement(Waiting, null);\n      } else if (treatment.factor(\"playerCount\").value === 1) {\n        content = /*#__PURE__*/React.createElement(Loading, null);\n      } else {\n        content = /*#__PURE__*/React.createElement(DelayedWaitingForServer, null);\n      }\n    } else {\n      content = /*#__PURE__*/React.createElement(Round, rest);\n    }\n\n    const BC = Breadcrumb !== undefined ? Breadcrumb : DefaultBreadcrumb;\n    const breadcrumb = BC && /*#__PURE__*/React.createElement(BC, {\n      game: game,\n      player: player,\n      round: round,\n      stage: stage\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"game\"\n    }, breadcrumb, content);\n  }\n\n}","map":{"version":3,"sources":["packages/empirica:core/ui/components/Game.jsx"],"names":["_objectSpread","module","link","default","v","_extends","_objectWithoutProperties","export","Game","React","addPlayerInput","markPlayerExitStepDone","playerReady","GameLobby","GameLobbyContainer","DefaultBreadcrumb","DelayedDisplay","ExitSteps","InstructionSteps","Loading","WaitingForServer","DelayedWaitingForServer","DelayedGameLobby","playerReadyClicked","Component","shouldComponentUpdate","nextProps","nextState","_","isEqual","props","render","loading","gameLobby","treatment","Round","Breadcrumb","Waiting","Lobby","exitSteps","introSteps","rest","started","timedOut","game","player","round","stage","exitAt","stepName","data","playerId","_id","call","nativeEvent","encoded","JSON","stringify","gameId","gameLobbyId","e","console","error","readyAt","gameLobbyProps","content","factor","value","BC","undefined","breadcrumb"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { addPlayerInput } from \"../../api/player-inputs/methods.js\";\nimport {\n  markPlayerExitStepDone,\n  playerReady\n} from \"../../api/players/methods.js\";\nimport GameLobby from \"../components/GameLobby.jsx\";\nimport GameLobbyContainer from \"../containers/GameLobbyContainer.jsx\";\nimport DefaultBreadcrumb from \"./Breadcrumb.jsx\";\nimport DelayedDisplay from \"./DelayedDisplay.jsx\";\nimport ExitSteps from \"./ExitSteps.jsx\";\nimport InstructionSteps from \"./InstructionSteps.jsx\";\nimport Loading from \"./Loading.jsx\";\nimport WaitingForServer from \"./WaitingForServer.jsx\";\n\nconst DelayedWaitingForServer = DelayedDisplay(WaitingForServer, 250);\nconst DelayedGameLobby = DelayedDisplay(GameLobby, 250);\n\nlet playerReadyClicked = false;\n\nexport default class Game extends React.Component {\n  shouldComponentUpdate(nextProps, nextState) {\n    return !_.isEqual(this.props, nextProps);\n  }\n\n  render() {\n    const {\n      loading,\n      gameLobby,\n      treatment,\n      Round,\n      Breadcrumb,\n      Waiting,\n      Lobby,\n      exitSteps,\n      introSteps,\n      ...rest\n    } = this.props;\n    const { started, timedOut, game, player, round, stage } = rest;\n\n    if (loading) {\n      return <Loading />;\n    }\n\n    if (player.exitAt) {\n      return (\n        <ExitSteps\n          {...rest}\n          steps={exitSteps(game || gameLobby, player)}\n          game={game || gameLobby}\n          player={player}\n          onSubmit={(stepName, data) => {\n            const playerId = player._id;\n            markPlayerExitStepDone.call({ playerId, stepName });\n            // Checkig for data.nativeEvent, as that indicates the data is an\n            // event object dispached by React.\n            if (data && !data.nativeEvent) {\n              try {\n                const encoded = JSON.stringify(data);\n                addPlayerInput.call({\n                  playerId,\n                  data: encoded,\n                  gameId: game && game._id,\n                  gameLobbyId: game ? null : gameLobby && gameLobby._id\n                });\n              } catch (e) {\n                console.error(\"could not encode data returned by onSubmit\", e);\n              }\n            }\n          }}\n        />\n      );\n    }\n\n    if (!game) {\n      if (playerReadyClicked) {\n        return <Loading />;\n      }\n\n      if (player.readyAt) {\n        const gameLobbyProps = {\n          ...rest,\n          gameLobby,\n          game: gameLobby,\n          treatment,\n          player\n        };\n\n        return (\n          <GameLobbyContainer {...gameLobbyProps}>\n            {Lobby ? (\n              <Lobby {...gameLobbyProps} />\n            ) : (\n              <DelayedGameLobby {...gameLobbyProps} />\n            )}\n          </GameLobbyContainer>\n        );\n      }\n\n      return (\n        <InstructionSteps\n          {...rest}\n          introSteps={introSteps}\n          treatment={treatment}\n          player={player}\n          onDone={() => {\n            playerReadyClicked = true;\n            playerReady.call({ _id: player._id }, () => {\n              playerReadyClicked = false;\n            });\n          }}\n        />\n      );\n    }\n\n    let content;\n    if (timedOut || !started) {\n      if (Waiting) {\n        content = <Waiting />;\n      } else if (treatment.factor(\"playerCount\").value === 1) {\n        content = <Loading />;\n      } else {\n        content = <DelayedWaitingForServer />;\n      }\n    } else {\n      content = <Round {...rest} />;\n    }\n\n    const BC = Breadcrumb !== undefined ? Breadcrumb : DefaultBreadcrumb;\n    const breadcrumb = BC && (\n      <BC game={game} player={player} round={round} stage={stage} />\n    );\n\n    return (\n      <div className=\"game\">\n        {breadcrumb}\n        {content}\n      </div>\n    );\n  }\n}\n"]},"sourceType":"module","hash":"d236841608e71bc448b9aa1ceedd873d009c95cb"}
